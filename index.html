<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Adivinanzas</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Juego de Adivinanzas</h1>

    <div id="setup">
        <label for="numTeams">Ingrese la cantidad de equipos: </label>
        <input type="number" id="numTeams" min="1">
        <button onclick="setupTeams()">Continuar</button>
        <div id="teamsContainer" class="hidden"></div>
    </div>

    <div id="game" class="hidden">
        <h2 id="roundInfo"></h2>
        <h3 id="turnInfo"></h3>
        <p id="wordDisplay" class="hidden"></p>
        <div id="cronometerDisplay">Tiempo restante: 2:30</div>
        <button id="startTimer" onclick="startTimer()">Iniciar Contador</button>
        <button id="wordGuessed" class="hidden" onclick="wordGuessed()">Palabra Adivinada</button>
        <button id="skipWord" class="hidden" onclick="skipWord()">Cambiar Palabra</button>
        <p id="scoreInfo" class="score"></p>
    </div>

    <script>
        let teams = [];
        let currentRound = 1;
        const numRounds = 3;
        let currentTeamIndex = 0;
        let currentPlayerIndex = 0;
        let timerInterval = null;
        const totalTeamTime = 150; // Tiempo total por equipo en segundos (2 minutos y 30 segundos)
        let timeRemaining = totalTeamTime;
        let wordStartTime = null; // Marca de tiempo para calcular puntos por palabra
        let categories = {
            "Animales": ["elefante", "jirafa", "león", "canguro", "pingüino"],
            "Películas": ["Titanic", "Avatar", "Inception", "Gladiator", "Joker"],
            "Ciencia": ["microscopio", "átomo", "gravedad", "planeta", "química"],
            "Deportes": ["fútbol", "básquet", "tenis", "natación", "rugby"]
        };
        let currentCategory = "";
        let currentWord = "";

        function setupTeams() {
            const numTeams = parseInt(document.getElementById("numTeams").value);
            if (!numTeams || numTeams < 1) {
                alert("Ingrese un número válido de equipos.");
                return;
            }
            const teamsContainer = document.getElementById("teamsContainer");
            teamsContainer.innerHTML = "";
            for (let i = 0; i < numTeams; i++) {
                const teamDiv = document.createElement("div");
                teamDiv.innerHTML = `
                    <h3>Equipo ${i + 1}</h3>
                    <label for="teamName${i}">Nombre del equipo: </label>
                    <input type="text" id="teamName${i}">
                    <label for="numPlayers${i}">Cantidad de integrantes: </label>
                    <input type="number" id="numPlayers${i}" min="1">
                `;
                teamsContainer.appendChild(teamDiv);
            }
            teamsContainer.classList.remove("hidden");
            const button = document.createElement("button");
            button.textContent = "Iniciar Juego";
            button.onclick = startGameSetup;
            teamsContainer.appendChild(button);
        }

        function startGameSetup() {
            const numTeams = parseInt(document.getElementById("numTeams").value);
            for (let i = 0; i < numTeams; i++) {
                const teamName = document.getElementById(`teamName${i}`).value;
                const numPlayers = parseInt(document.getElementById(`numPlayers${i}`).value);
                if (!teamName || !numPlayers || numPlayers < 1) {
                    alert("Complete todos los campos correctamente.");
                    return;
                }
                const members = [];
                for (let j = 0; j < numPlayers; j++) {
                    members.push(prompt(`Nombre del integrante ${j + 1} del equipo ${teamName}:`));
                }
                teams.push({ name: teamName, members, score: 0 });
            }
            document.getElementById("setup").classList.add("hidden");
            startRound();
        }

        function startRound() {
            if (currentRound > numRounds) {
                endGame();
                return;
            }
            currentCategory = Object.keys(categories)[Math.floor(Math.random() * Object.keys(categories).length)];
            document.getElementById("game").classList.remove("hidden");
            document.getElementById("roundInfo").textContent = `Ronda ${currentRound} - Categoría: ${currentCategory}`;
            currentTeamIndex = 0;
            currentPlayerIndex = 0;
            timeRemaining = totalTeamTime; // Reinicia el tiempo solo al comienzo del turno del equipo
            startTurn();
        }

        function startTurn() {
            if (currentTeamIndex >= teams.length) {
                currentRound++;
                startRound();
                return;
            }
            const team = teams[currentTeamIndex];
            const player = team.members[currentPlayerIndex];
            document.getElementById("turnInfo").textContent = `Turno de ${player} del equipo ${team.name}`;
            loadNewWord();
            startTimer();
        }

        function startTimer() {
            updateTimerDisplay();
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    stopTimer();
                    nextTurn();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById("cronometerDisplay").textContent = `Tiempo restante: ${minutes}:${seconds.toString().padStart(2, "0")}`;
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function loadNewWord() {
            currentWord = categories[currentCategory][Math.floor(Math.random() * categories[currentCategory].length)];
            document.getElementById("wordDisplay").textContent = `Palabra: ${currentWord}`;
            document.getElementById("wordDisplay").classList.remove("hidden");
            document.getElementById("startTimer").classList.add("hidden");
            document.getElementById("wordGuessed").classList.remove("hidden");
            document.getElementById("skipWord").classList.remove("hidden");
            wordStartTime = timeRemaining; // Marca el inicio de tiempo de la palabra actual
        }

        function wordGuessed() {
            const timeSpent = wordStartTime - timeRemaining; // Tiempo usado en adivinar
            const points = Math.max(10 - timeSpent, 1); // Fórmula: 10 puntos menos 1 por segundo usado (mínimo 1 punto)
            teams[currentTeamIndex].score += points;
            document.getElementById("scoreInfo").textContent = `El equipo ${teams[currentTeamIndex].name} ganó ${points} puntos.`;
            loadNewWord();
        }

        function skipWord() {
            loadNewWord();
        }

        function nextTurn() {
            stopTimer();
            currentPlayerIndex++;
            const team = teams[currentTeamIndex];
            if (currentPlayerIndex >= team.members.length) {
                currentPlayerIndex = 0;
                currentTeamIndex++;
            }
            startTurn();
        }

        function endGame() {
            const winner = teams.reduce((best, team) => (team.score > best.score ? team : best), teams[0]);
            alert(`¡El juego ha terminado! El equipo ganador es ${winner.name} con ${winner.score} puntos.`);
        }
    </script>
</body>
</html>
